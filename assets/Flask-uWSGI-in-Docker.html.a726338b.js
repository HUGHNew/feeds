import{r as l,o as c,c as r,a as n,b as a,w as p,F as i,d as s,e as o}from"./app.7d274c27.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const d={},k=n("h1",{id:"flask-nginx-in-docker",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#flask-nginx-in-docker","aria-hidden":"true"},"#"),s(" Flask-nginx in Docker")],-1),b=n("blockquote",null,[n("p",null,"\u4F7F\u7528\u4E24\u4E2A\u5BB9\u5668 \u90E8\u7F72 Flask")],-1),m=s("Flask/uWSGI nginx\u7684\u57FA\u7840\u4F7F\u7528\u53EF\u4EE5\u770B"),g=s("\u8FD9\u91CC"),h=n("h2",{id:"docker-\u914D\u7F6E",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#docker-\u914D\u7F6E","aria-hidden":"true"},"#"),s(" docker \u914D\u7F6E")],-1),_={class:"custom-container tip"},f=n("p",{class:"custom-container-title"},"\u5BB9\u5668\u62C9\u53D6",-1),v=n("p",null,[n("code",null,"sudo docker pull git4docker/flask nginx:alpine")],-1),x=s("git4docker/flask\u7684"),w={href:"https://raw.githubusercontent.com/HUGHNew/Dockerfiles/master/Dockerfile.flask",target:"_blank",rel:"noopener noreferrer"},y=s("Dockerfile"),q=o(`<p>\u56E0\u4E3A\u9700\u8981nginx\u53CD\u5411\u4EE3\u7406<code>uwsgi</code> \u6240\u4EE5\u9700\u8981nginx\u77E5\u9053Flask\u5BB9\u5668\u7684\u5730\u5740</p><p>\u5728\u4E0D\u4F7F\u7528 <code>Docker Compose</code> \u548C K8S \u7684\u60C5\u51B5\u4E0B \u53EF\u4EE5\u7528\u4E24\u79CD\u65B9\u5F0F\u8BA9nginx\u5BB9\u5668\u77E5\u9053Flask\u5BB9\u5668\u7684\u5B58\u5728</p><ul><li>run --link: \u542F\u52A8nginx\u7684\u65F6\u5019\u5C06flask\u5BB9\u5668link\u5165nginx\u5BB9\u5668\u4E2D</li><li>docker network: \u914D\u7F6E\u4E00\u4E2A nginx \u548C flask \u5171\u7528\u7684\u6865\u63A5\u7F51\u7EDC</li></ul><p><code>docker network create __your_network_name__</code> \u9ED8\u8BA4\u4F7F\u7528\u6865\u63A5(Bridge)\u7F51\u7EDC \u5373 <code>create -d bridge</code></p><blockquote><p>\u672C\u6587\u4E2D\u521B\u5EFA\u7684\u7F51\u7EDC\u4E3A<code>backend</code></p></blockquote><h2 id="uwsgi-\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#uwsgi-\u914D\u7F6E" aria-hidden="true">#</a> uwsgi \u914D\u7F6E</h2><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">uwsgi</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">socket</span> <span class="token punctuation">=</span><span class="token value attr-value">:5000</span>
<span class="token key attr-name">stats</span> <span class="token punctuation">=</span><span class="token value attr-value">:9191</span>
<span class="token key attr-name">chdir</span> <span class="token punctuation">=</span> <span class="token value attr-value">/flask</span>
<span class="token key attr-name">wsgi-file</span> <span class="token punctuation">=</span> <span class="token value attr-value">app.py</span>
<span class="token key attr-name">callable</span> <span class="token punctuation">=</span> <span class="token value attr-value">app</span>
<span class="token key attr-name">processes</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token key attr-name">threads</span> <span class="token punctuation">=</span> <span class="token value attr-value">2</span>
<span class="token key attr-name">pidfile</span> <span class="token punctuation">=</span> <span class="token value attr-value">uwsgi.pid</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div>`,7),F={class:"custom-container tip"},D=n("p",{class:"custom-container-title"},"uwsgi \u914D\u7F6E\u5BF9\u6BD4",-1),I=s("\u5BF9\u6BD4"),E=s("\u6B63\u5E38\u4F7F\u7528\u7684\u4EE3\u7801"),S=s(" \u5C11\u4E86"),B=n("code",null,"daemonize = uwsgi.log",-1),G=o(`<h2 id="nginx-\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#nginx-\u914D\u7F6E" aria-hidden="true">#</a> nginx \u914D\u7F6E</h2><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>upstream flask_server{
  server flask:5000;
}
server {
  listen 80;
  server_name ngx;
  charset utf-8;

  location / {
    uwsgi_pass flask_server;
    include uwsgi_params;
  }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u4E3B\u8981\u5C31\u662F\u5199\u4E00\u4E2A\u914D\u7F6E\u6587\u4EF6</p><div class="custom-container tip"><p class="custom-container-title">nginx\u914D\u7F6E</p><p><code>alpine</code> nginx \u7684 <code>nginx.conf</code> \u91CC\u9762\u9ED8\u8BA4include <code>/etc/nginx/conf.d/*.conf</code></p></div><h2 id="\u9879\u76EE\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u7ED3\u6784" aria-hidden="true">#</a> \u9879\u76EE\u7ED3\u6784</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
\u251C\u2500\u2500 flask
\u2502   \u251C\u2500\u2500 app.py
\u2502   \u251C\u2500\u2500 uwsgi.ini
\u251C\u2500\u2500 ngx
\u2502   \u2514\u2500\u2500 flask.conf
\u2514\u2500\u2500 run.sh
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="\u5BB9\u5668\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#\u5BB9\u5668\u542F\u52A8" aria-hidden="true">#</a> \u5BB9\u5668\u542F\u52A8</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token function">sudo</span> <span class="token function">docker</span> run --network backend <span class="token punctuation">\\</span>
  --rm -itd -v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/flask:/flask <span class="token punctuation">\\</span>
  --name flask flask uwsgi /flask/uwsgi.ini
<span class="token function">sudo</span> <span class="token function">docker</span> run --network backend <span class="token punctuation">\\</span>
  --rm -d -v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/ngx:/etc/nginx/conf.d <span class="token punctuation">\\</span>
  --name ngx -p <span class="token number">8000</span>:80 nginx:alpine nginx -g <span class="token string">&#39;daemon off;&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5BB9\u5668\u542F\u52A8\u65F6\u7684\u5BB9\u5668\u540D\u914D\u7F6E\u662F\u5FC5\u987B\u7684</p><details class="custom-container details"><summary>\u4E00\u4E9B\u5C0F\u63D0\u793A</summary><p>flask \u5BB9\u5668\u7684\u5BB9\u5668\u540D\u53EF\u4EE5\u4FEE\u6539 \u4E0D\u8FC7\u9700\u8981\u4FDD\u8BC1 <code>docker run</code> \u65F6\u7684name\u548C <code>nginx upstream</code> \u4E2D\u914D\u7F6E\u7684\u76F8\u540C</p><p>nginx \u5BB9\u5668\u5FC5\u987B\u524D\u53F0\u542F\u52A8</p></details><h2 id="\u4F7F\u7528-docker-compose" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-docker-compose" aria-hidden="true">#</a> \u4F7F\u7528 docker compose</h2><p>compose \u914D\u7F6E\u6587\u4EF6</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">flask</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> flask
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;git4docker/flask:backend&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;./flask:/flask&quot;</span>

  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx:alpine&quot;</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8000:80&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;./ngx:/etc/nginx/conf.d&quot;</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx -g &#39;daemon off;&#39;&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>\u62C9\u53D6\u955C\u50CF <code>docker compose pull</code></p><p>\u542F\u52A8\u670D\u52A1 <code>docker compose up</code>(\u524D\u53F0\u542F\u52A8 \u53EF\u4EE5\u67E5\u770B\u65E5\u5FD7) \u6216\u8005 <code>docker compose up -d</code>(daemon\u540E\u53F0\u542F\u52A8)</p><h2 id="\u53C2\u8003" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003" aria-hidden="true">#</a> \u53C2\u8003</h2>`,16),N={href:"https://www.cnblogs.com/weifeng1463/p/10277178.html",target:"_blank",rel:"noopener noreferrer"},j=s("nginx daemon off"),L={href:"https://juejin.cn/post/6904201044390051848",target:"_blank",rel:"noopener noreferrer"},V=s("Docker network \u539F\u7406"),W={href:"https://yeasy.gitbook.io/docker_practice/network/linking",target:"_blank",rel:"noopener noreferrer"},C=s("\u5BB9\u5668\u7F51\u7EDC\u4F7F\u7528");function H(R,U){const t=l("RouterLink"),e=l("ExternalLinkIcon");return c(),r(i,null,[k,b,n("p",null,[m,a(t,{to:"/blogs/Flask-uWSGI-nginx.html"},{default:p(()=>[g]),_:1})]),h,n("div",_,[f,v,n("p",null,[x,n("a",w,[y,a(e)])])]),q,n("div",F,[D,n("p",null,[I,a(t,{to:"/blogs/Flask-uWSGI-nginx.html#%E9%85%8D%E7%BD%AE"},{default:p(()=>[E]),_:1}),S,B])]),G,n("ul",null,[n("li",null,[n("a",N,[j,a(e)])]),n("li",null,[n("a",L,[V,a(e)])]),n("li",null,[n("a",W,[C,a(e)])])])],64)}var A=u(d,[["render",H]]);export{A as default};
